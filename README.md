# Tenpo Challenge - Spring Boot
![technology Java](https://img.shields.io/badge/technology-java-blue.svg)
![tag jdk8](https://img.shields.io/badge/tag-jdk8-orange.svg)

Completed as part of the coding challenge for Tenpo.

## NOTES

I could achieve implement the following features:

- Users creation
- Users login
- Users logout
- Get requests history
- Feature to sum two number by a logged user
  
Plus:
- Token security implementation and password encoding.

**IMPORTANT: Just one user can be logged at the same time**

For time purposes, couldn't achieve the following features:

- Application runs in a h2 memory database instead of using PostgresQl.

## Required pre-requisites:
    Maven
    Java JDK 1.8

## How to run the project?
Run the following commands in order:

1. Clone repo from Github
2. From terminal, in project root, run command **mvn clean package**
3. Run command **sudo docker build --tag=tenpo-challenge:latest .**
4. Run command **sudo docker run -d -p 8080:8080 -t tenpo-challenge:latest**

or you can download the image from dockerhub:

https://hub.docker.com/r/santi101093/dockerhub/tags

with the following commands:

1- **sudo docker pull santi101093/dockerhub:tenpo**
2- Run command **sudo docker run -d -p 8080:8080 -t santi101093/dockerhub:tenpo**

Project will run in localhost:8080.

**IMPORTANT:** Once the application stops, the stored data in database will we deleted because H2 is a database that runs in memory

## Api Usage

All the endpoints and request examples are in this public postman collection:

[![Run in Postman](https://run.pstmn.io/button.svg)](https://app.getpostman.com/run-collection/1e2c96a770938732bdac?action=collection%2Fimport)

### Create User

- Creates an user with a user_name and a password. User data is saved in db in an encrypted way.
- If user already exists throws a user already exists custom bad request error.
- Returns an autogenerated id that is related to the user.

`POST` localhost:8080/users

`BODY`
```json
{
  "user_name": "user123",
  "password": "user123"
}
```

##### Response
**Status**: `200 OK`
```json
{
  "id": 1
}
```

#### Error Response Format
**Status**: `400 Bad request`
```json
{
  "error": "User already exists",
  "message": "The user with user name user123 does not exists",
  "status": 404
}
```

**Status**: `400 Bad Request`
```json
{
  "message": "Method Argument Not Valid",
  "errors": [
    "Please provide a user_name attribute in JSON request"
  ],
  "status": 400
}
```

### Login user

- Authenticate an existing user. user_name and password must coincide with the user stored data.
- Returns the user id and a JWT generated session token.
- If user does not exist, returns a custom user does not exist not found error.
- If user information does not coincide with the user stored data, returns custom bad request password invalid exception.

**IMPORTANT: Just one user can be logged at the same time**

`POST` http://localhost:8080/auth/login

`BODY`
```json
{
  "user_name": "user123",
  "password": "user123"
}
```

#### Success Response
**Status**: `200 OK`
```json
{
  "id": 2,
  "token": "Bearer eyJhbGciOiJIUzUxMiJ9.eyJqdGkiOiJDaGFsbGVuZ2VKV1QiLCJzdWIiOiJzYW50aTEiLCJhdXRob3JpdGllcyI6WyJST0xFX1VTRVIiXSwiaWF0IjoxNjI2Nzg4NjE4LCJleHAiOjE2MjY3ODkyMTh9.Zw-eixgdxqu58Zs-MYLlUY5UHwzF_eXSAHs4ruItN32jmEIa0zeFF4Afh6M2R4yb9EqxUBlRiQGKJrWuGmNdhA"
}
```
#### Error Response Format

**Status**: `400 Bad Request`
```json
{
  "message": "Method Argument Not Valid",
  "errors": [
    "Please provide a user_name attribute in JSON request"
  ],
  "status": 400
}
```
**Status**: `404 Not found`
```json
{
  "error": "User does not exist",
  "message": "The user with user name user123 does not exists",
  "status": 404
}
```

**Status**: `400 Bad request`
```json
{
  "error": "Password not valid exception",
  "message": "Password not valid for user user123",
  "status": 400
}
```

### Logout user

- Logouts an existing user. user_name must coincide with a user stored data.
- Returns the user id.
- If user does not exist, returns a custom user does not exist not found error.
- If user information does not coincide with the user stored data, returns custom not found exception.

`POST` http://localhost:8080/auth/logout

`BODY`
```json
{
  "user_name": "user123"
}
```

#### Success Response
**Status**: `200 OK`
```json
{
  "id": 2
}
```
#### Error Response Format

**Status**: `400 Bad Request`
```json
{
  "message": "Method Argument Not Valid",
  "errors": [
    "Please provide a user_name attribute in JSON request"
  ],
  "status": 400
}
```
**Status**: `404 Not found`
```json
{
  "error": "User does not exist",
  "message": "The user with user name user123 does not exists",
  "status": 404
}
```

### Addition of numbers

- Perform the addition of two numbers.
- It requires an existing user name and his realated authorization token provided in login (**IMPORTANT: Just one user can be logged at the same time**)
- Returns the result of the addition.
- It requires an authorization header with the provided token in login post.

`POST` http://localhost:8080/messages

`HEADERS`
```json
"Authorization":"Bearer eyJhbGciOiJIUzUxMiJ9.eyJqdGkiOiJDaGFsbGVuZ2VKV1QiLCJzdWIiOiJzYW50aTEiLCJhdXRob3JpdGllcyI6WyJST0xFX1VTRVIiXSwiaWF0IjoxNjI2Nzg4NjE4LCJleHAiOjE2MjY3ODkyMTh9.Zw-eixgdxqu58Zs-MYLlUY5UHwzF_eXSAHs4ruItN32jmEIa0zeFF4Afh6M2R4yb9EqxUBlRiQGKJrWuGmNdhA"
```

`BODY`
```json
{
  "user_name": "user",
  "first_number": 1.0,
  "second_number": 2.0
}
```

#### Success Response
**Status**: `200 OK`
```
{
    "result": 3.0
}
```
#### Error Response Format

**Status**: `404 Not found`
```json
{
  "error": "User does not exist",
  "message": "The user with id 2 does not exist",
  "status": 404
}
```

**Status**: `403 fordidden`
```json
{
  "error": "Forbidden",
  "message": "",
  "status": 403
}
```

### Get request history

- Gets all the requests performed.

`GET` http://localhost:8080/search?offset=0&limit=100

#### Success Response
**Status**: `200 OK`
```json
{
  "requests": [
    {
      "id": 1,
      "url": "/users",
      "user": 1
    },
    {
      "id": 2,
      "url": "/users",
      "user": 2
    },
    {
      "id": 3,
      "url": "auth/login",
      "user": 1
    },
    {
      "id": 4,
      "url": "/users",
      "user": 3
    },
    {
      "id": 5,
      "url": "auth/logout",
      "user": 1
    }
  ]
}
```

### Reference Documentation
For further reference, please consider the following sections:

* [Official Apache Maven documentation](https://maven.apache.org/guides/index.html)
* [Spring Boot Maven Plugin Reference Guide](https://docs.spring.io/spring-boot/docs/2.4.3/maven-plugin/reference/html/)
* [Create an OCI image](https://docs.spring.io/spring-boot/docs/2.4.3/maven-plugin/reference/html/#build-image)
* [Spring Web](https://docs.spring.io/spring-boot/docs/2.4.3/reference/htmlsingle/#boot-features-developing-web-applications)
* [Spring Data JPA](https://docs.spring.io/spring-boot/docs/2.4.3/reference/htmlsingle/#boot-features-jpa-and-spring-data)
* [Spring Security](https://docs.spring.io/spring-security/site/docs/current/reference/html5/)

### Guides
The following guides illustrate how to use some features concretely:

* [Building a RESTful Web Service](https://spring.io/guides/gs/rest-service/)
* [Serving Web Content with Spring MVC](https://spring.io/guides/gs/serving-web-content/)
* [Building REST services with Spring](https://spring.io/guides/tutorials/bookmarks/)
* [Accessing Data with JPA](https://spring.io/guides/gs/accessing-data-jpa/)

## Questions
* [santi101093@gmail.com](mailto:santi101093@gmail.com)

